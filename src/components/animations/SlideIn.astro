---
interface Props {
    direction?: 'up' | 'down' | 'left' | 'right';
    delay?: number;
    duration?: number;
    class?: string;
}

const {
    direction = 'up',
    delay = 0,
    duration = 0.6,
    class: className = ''
} = Astro.props;

const initialTransforms = {
    up: 'translateY(30px)',
    down: 'translateY(-30px)',
    left: 'translateX(30px)',
    right: 'translateX(-30px)'
};

const initialTransform = initialTransforms[direction];
---

<div
    class={`slide-in-wrapper ${className}`}
    data-animate="slide"
    style={`opacity: 0; transform: ${initialTransform}; transition-delay: ${delay}s; transition-duration: ${duration}s;`}
>
    <slot />
</div>

<script>
    // Single shared observer for all slide-in elements
    function initSlideAnimations() {
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const elements = document.querySelectorAll('[data-animate="slide"]');

        if (prefersReducedMotion) {
            elements.forEach(el => {
                (el as HTMLElement).style.opacity = '1';
                (el as HTMLElement).style.transform = 'none';
            });
            return;
        }

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        (entry.target as HTMLElement).style.opacity = '1';
                        (entry.target as HTMLElement).style.transform = 'translate3d(0, 0, 0)';
                        observer.unobserve(entry.target);
                    }
                });
            },
            { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
        );

        elements.forEach(el => observer.observe(el));
    }

    // Run on initial load and after View Transitions
    initSlideAnimations();
    document.addEventListener('astro:after-swap', initSlideAnimations);
</script>

<style>
    .slide-in-wrapper {
        transition-property: opacity, transform;
        transition-timing-function: ease-out;
        contain: layout style;
    }
</style>
