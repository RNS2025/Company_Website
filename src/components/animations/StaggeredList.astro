---
interface Props {
    staggerDelay?: number;
    class?: string;
}

const {
    staggerDelay = 0.1,
    class: className = ''
} = Astro.props;

const id = `staggered-${Math.random().toString(36).substr(2, 9)}`;
---

<div
    id={id}
    class={`staggered-list ${className}`}
    data-stagger-delay={staggerDelay}
>
    <slot />
</div>

<script>
    // Staggered animation for list items
    const staggeredContainers = document.querySelectorAll('.staggered-list');

    staggeredContainers.forEach((container) => {
        const staggerDelay = parseFloat(container.getAttribute('data-stagger-delay') || '0.1');
        const children = Array.from(container.children) as HTMLElement[];

        // Set initial state for all children
        children.forEach((child, index) => {
            child.style.opacity = '0';
            child.style.transform = 'translateY(20px)';
            child.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        });

        const observer = new IntersectionObserver(
            (entries) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        // Animate children with stagger
                        children.forEach((child, index) => {
                            setTimeout(() => {
                                child.style.opacity = '1';
                                child.style.transform = 'translateY(0)';
                            }, index * staggerDelay * 1000);
                        });
                        observer.unobserve(entry.target);
                    }
                });
            },
            {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            }
        );

        observer.observe(container);
    });
</script>

<style>
    .staggered-list > * {
        will-change: opacity, transform;
    }
</style>
