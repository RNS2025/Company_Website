---
const BASE_URL = import.meta.env.BASE_URL || '/';
const currentPath = Astro.url.pathname;

const links = [
    { href: `${BASE_URL}`, text: 'Forside' },
    { href: `${BASE_URL}projekter/`, text: 'Projekter' },
    { href: `${BASE_URL}om-os/`, text: 'Om Os' },
    { href: `${BASE_URL}kontakt/`, text: 'Kontakt' }
];

// Check if link is active
const isActive = (href: string) => {
    if (href === BASE_URL) {
        return currentPath === BASE_URL || currentPath === '/';
    }
    return currentPath.startsWith(href);
};
---

<header
    id="main-header"
    class="glass-header sticky top-0 z-50 w-full"
>
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <!-- Logo with glow effect -->
        <a
            href={BASE_URL}
            class="logo-wrapper transition-all duration-300 hover:scale-105"
            aria-label="RNS APPS Forside"
        >
            <img
                alt="RNS APPS Logo"
                src="/logo.png"
                class="h-14 w-auto"
                width="56"
                height="56"
            />
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center space-x-1" aria-label="PrimÃ¦r navigation">
            {links.map(link => (
                <a
                    href={link.href}
                    data-astro-prefetch="load"
                    class={`
                        nav-link px-4 py-2 rounded-full font-medium transition-all duration-300
                        ${isActive(link.href)
                            ? 'bg-primary-500/20 text-primary-500'
                            : 'text-slate-300 hover:text-white hover:bg-white/10'}
                    `}
                    aria-current={isActive(link.href) ? 'page' : undefined}
                >
                    {link.text}
                </a>
            ))}

            <!-- CTA Button -->
            <a
                href="/kontakt/"
                data-astro-prefetch="load"
                class="ml-4 px-5 py-2 bg-gradient-to-r from-primary-500 to-primary-600 rounded-full text-white font-semibold hover:shadow-lg hover:shadow-primary-500/30 hover:scale-105 transition-all duration-300"
            >
                Start Projekt
            </a>
        </nav>

        <!-- Mobile Menu Button -->
        <button
            id="mobile-menu-button"
            class="md:hidden p-2 rounded-lg hover:bg-dark-lighter transition-colors focus-ring"
            aria-label="Toggle menu"
            aria-expanded="false"
            aria-controls="mobile-menu"
        >
            <svg
                id="menu-icon"
                class="w-6 h-6 text-slate-300"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"
                />
            </svg>
            <svg
                id="close-icon"
                class="w-6 h-6 text-slate-300 hidden"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                />
            </svg>
        </button>
    </div>

    <!-- Mobile Menu -->
    <div
        id="mobile-menu"
        class="hidden md:hidden overflow-hidden glass-mobile-menu"
        aria-label="Mobil navigation"
    >
        <nav class="container mx-auto px-6 py-6 flex flex-col space-y-2">
            {links.map(link => (
                <a
                    href={link.href}
                    data-astro-prefetch="load"
                    class={`
                        text-lg font-medium transition-all duration-300 py-3 px-4 rounded-xl
                        ${isActive(link.href)
                            ? 'bg-primary-500/20 text-primary-500'
                            : 'text-slate-300 hover:bg-white/10 hover:text-white'
                        }
                    `}
                    aria-current={isActive(link.href) ? 'page' : undefined}
                >
                    {link.text}
                </a>
            ))}

            <!-- Mobile CTA -->
            <a
                href="/kontakt/"
                data-astro-prefetch="load"
                class="mt-4 text-center py-3 px-4 bg-gradient-to-r from-primary-500 to-primary-600 rounded-xl text-white font-semibold"
            >
                Start Projekt
            </a>
        </nav>
    </div>
</header>

<style>
    .glass-header {
        background: rgba(42, 42, 42, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 105, 65, 0.3);
        box-shadow:
            0 4px 30px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .glass-mobile-menu {
        background: rgba(42, 42, 42, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo-wrapper:hover img {
        filter: drop-shadow(0 0 10px rgba(255, 105, 65, 0.5));
    }

    .nav-link {
        position: relative;
    }

    .nav-link::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 9999px;
        opacity: 0;
        background: linear-gradient(135deg, rgba(255, 105, 65, 0.2), rgba(242, 134, 95, 0.1));
        transition: opacity 0.3s ease;
    }

    .nav-link:hover::before {
        opacity: 1;
    }
</style>

<script>
    function initMobileMenu() {
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');
        const closeIcon = document.getElementById('close-icon');

        if (!menuButton || !mobileMenu) return;

        // Reset menu state on page navigation
        mobileMenu.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        menuButton.setAttribute('aria-expanded', 'false');

        // Remove old listeners by cloning the button
        const newMenuButton = menuButton.cloneNode(true) as HTMLElement;
        menuButton.parentNode?.replaceChild(newMenuButton, menuButton);

        // Add click handler for menu toggle
        newMenuButton.addEventListener('click', () => {
            const isExpanded = newMenuButton.getAttribute('aria-expanded') === 'true';

            mobileMenu.classList.toggle('hidden');
            menuIcon?.classList.toggle('hidden');
            closeIcon?.classList.toggle('hidden');
            newMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
        });

        // Close mobile menu when clicking a link
        const mobileLinks = mobileMenu.querySelectorAll('a');
        mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
                menuIcon?.classList.remove('hidden');
                closeIcon?.classList.add('hidden');
                newMenuButton.setAttribute('aria-expanded', 'false');
            });
        });
    }

    // Initialize on load
    initMobileMenu();

    // Reinitialize after View Transitions
    document.addEventListener('astro:after-swap', initMobileMenu);
</script>