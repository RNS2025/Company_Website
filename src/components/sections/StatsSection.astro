---
import FadeIn from "../animations/FadeIn.astro";
import Section from "../ui/Section.astro";
import Icon from "../ui/Icon.astro";

interface Stat {
  icon: string;
  value: string;
  label: string;
  suffix?: string;
}

const stats: Stat[] = [
  {
    icon: "users",
    value: "1",
    suffix: "+",
    label: "Tilfredse Kunder",
  },
  {
    icon: "code",
    value: "2",
    suffix: "+",
    label: "Projekter Leveret",
  },
  {
    icon: "award",
    value: "5",
    label: "Års Erfaring",
  },
  {
    icon: "zap",
    value: "99",
    suffix: "%",
    label: "Kundetilfredshed",
  },
];
---

<Section class="relative overflow-hidden">
  <!-- Background gradient -->
  <div
    class="absolute inset-0 bg-gradient-to-br from-primary-500/10 via-primary-600/10 to-primary-700/10 rounded-3xl"
  >
  </div>

  <div class="relative">
    <FadeIn>
      <div class="text-center mb-12">
        <h2 class="text-4xl md:text-5xl font-bold mb-4">
          Resultater Der <span
            class="bg-gradient-to-r from-primary-500 to-primary-600 text-transparent bg-clip-text"
            >Taler</span
          >
        </h2>
        <p class="text-xl text-gray-300 max-w-2xl mx-auto">
          Vi leverer kvalitet og resultater som vores kunder kan stole på
        </p>
      </div>
    </FadeIn>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-8">
      {
        stats.map((stat, index) => (
          <FadeIn delay={index * 0.1}>
            <div class="text-center group">
              <div class="w-16 h-16 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300">
                <Icon name={stat.icon} class="w-8 h-8 text-white" />
              </div>

              <div
                class="stat-counter text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-primary-500 to-primary-600 text-transparent bg-clip-text"
                data-target={stat.value}
              >
                0{stat.suffix || ""}
              </div>

              <div class="text-gray-400 font-medium">{stat.label}</div>
            </div>
          </FadeIn>
        ))
      }
    </div>
  </div>
</Section>

<script>
  // Animated counter effect
  function animateCounter(element: HTMLElement) {
    const target = parseInt(element.dataset.target || "0");
    const duration = 2000;
    const steps = 60;
    const increment = target / steps;
    let current = 0;

    const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        element.textContent =
          target.toString() + (element.textContent?.match(/[+%]/) || [""])[0];
        clearInterval(timer);
      } else {
        element.textContent =
          Math.floor(current).toString() +
          (element.textContent?.match(/[+%]/) || [""])[0];
      }
    }, duration / steps);
  }

  // Intersection Observer to trigger animation when in view
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const counters = entry.target.querySelectorAll(".stat-counter");
          counters.forEach((counter) => {
            if (counter instanceof HTMLElement && !counter.dataset.animated) {
              counter.dataset.animated = "true";
              animateCounter(counter);
            }
          });
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.5 }
  );

  const statsSection = document
    .querySelector(".stat-counter")
    ?.closest("section");
  if (statsSection) {
    observer.observe(statsSection);
  }
</script>
